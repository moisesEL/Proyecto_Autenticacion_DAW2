<!DOCTYPE html>

<head>
    <title>Cambio de contraseña</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/change_password.css">
            <style>
            #responseMsg {
              margin-top: 1em;
              padding: 0.5em;
              display: none;
            }

            #responseMsg.success {
              color: green;
              background-color: #e0ffe0;
              border: 1px solid green;
            }

            #responseMsg.error {
              color: red;
              background-color: #ffe0e0;
              border: 1px solid red;
            }
        </style>

</head>

<body>
    <div class="contenedor">

        <h1>Change password </h1>
        
        <form id="changePassword" class="form" action="http://localhost:8080/CRUDBankServerSide/webresources/customer">
            
            <label for="emailUser">email</label>
            <input id="emailUser" name="emailUser" type="text" />

            <label for="ActualPassword">Current password</label>
            <input id="actualPassword" name="actualPassword" type="password" />

            <label for="NewPassword">New password</label>
            <input id="newPassword" name="newPassword" type="password" />

            <label for="confirmPassword">Confirm password</label>
            <input id="confirmPassword" name="confirmPassword" type="password" />
            <button class="button" id="ChangePasswordConfirm" 
                onclick="handleChangePasswordOnClick(event);">Change Password</button>
        </form>
                <div id="responseMsg"></div>

    </div>
<script type="text/javascript">

        sessionStorage.setItem(password , 1234);
        var passwordSession = storage.getItem(password);
        
    
        function handleChangePasswordOnClick (event) {
            try{
                // obtenemos id solo para validar contraseña similar.
                const emailUser = document.getElementById("emailUser");
            
                // obtenemos los elementos del form 
                const actualPassword = document.getElementById("actualPassword");
                const newPassword = document.getElementById("newPassword");
                const confirmPassword = document.getElementById("confirmPassword");
                
                event.preventDefault();
                event.stopPropagation();
                
                // valida si estan vacios:
                
                if(actualPassword.value.trim()===""||newPassword.value.trim()==="" || confirmPassword.value.trim()==="")
                throw new Error("Email and password must be filled.");
            
                // Valida si la Nueva contraseña cumple con requisitos:             
                const passwordRegExp=
                    new RegExp (/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{5,20}$/);
                if (!passwordRegExp.exec(newPassword.value.trim()))
                    throw new Error("New password has not a valid format. Please try again");
                
                // Valida si la nueva contraseña coincide con el campo de confirmacion de contraseña.
                if(newPassword.value.trim()!== confirmPassword.value.trim())
                    throw new Error("Your password and new password do not match.");

            // llamar a la funcion para llamar a los datos
                 sendRequestAndProcessResponse();
            } catch (error) {
              //Show error messages in red styled div
                    const msgBox = document.getElementById("responseMsg");
                    msgBox.className = 'error';
                    msgBox.textContent = 'Error: ' + error.message;
                    msgBox.style.display = 'block';               
                
            }

       }
        
        function sendRequestAndProcessResponse() {


                // obtenemos referencias
                const changePassword = document.getElementById("changePassword");
                const msgBox = document.getElementById("responseMSg")
                
                // Obtenemos valor de los campos
                const valueEmailUser = emailUser.value.trim();
                const valueActualPassword = actualPassword.value.trim();
                const valueNewPassword = newPassword.value.trim();
                const valueConfirmPassword = confirmPassword.value.trim(); 
                
                // Realizamos peticion
  

                
               console.log(valueEmailUser);                  
               console.log(valueActualPassword);  
               console.log(valueNewPassword);  
               console.log(valueConfirmPassword);     
             
            
        }
        
          console.log(passwordSession);
            
        
        
</script>
</body>

</html>